{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CRDWrapper",
  "type": "object",
  "required": [
    "apiVersion",
    "kind",
    "metadata",
    "spec"
  ],
  "properties": {
    "apiVersion": {
      "$ref": "#/definitions/APIVersion"
    },
    "kind": {
      "$ref": "#/definitions/CRDName"
    },
    "metadata": {
      "$ref": "#/definitions/Metadata"
    },
    "spec": {
      "$ref": "#/definitions/MicrosoftSentinelAutomationRuleSpec"
    }
  },
  "definitions": {
    "APIVersion": {
      "type": "string",
      "enum": [
        "buildrlabs.io/v1"
      ]
    },
    "Action": {
      "oneOf": [
        {
          "type": "object",
          "required": [
            "AddIncidentTagAction"
          ],
          "properties": {
            "AddIncidentTagAction": {
              "$ref": "#/definitions/AddIncidentTagAction"
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "RunPlaybookAction"
          ],
          "properties": {
            "RunPlaybookAction": {
              "$ref": "#/definitions/RunPlaybookAction"
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "AddIncidentTagAction": {
      "type": "object",
      "required": [
        "actionConfiguration",
        "actionType",
        "order"
      ],
      "properties": {
        "actionConfiguration": {
          "$ref": "#/definitions/AddIncidentTaskActionProperties"
        },
        "actionType": {
          "$ref": "#/definitions/AddIncidentTaskActionType"
        },
        "order": {
          "type": "integer",
          "format": "int64"
        }
      }
    },
    "AddIncidentTaskActionProperties": {
      "type": "object",
      "required": [
        "description",
        "title"
      ],
      "properties": {
        "description": {
          "type": "string"
        },
        "title": {
          "type": "string"
        }
      }
    },
    "AddIncidentTaskActionType": {
      "type": "string",
      "enum": [
        "Add Incident Task"
      ]
    },
    "ArrayConditionSupportedArrayType": {
      "type": "string",
      "enum": [
        "CustomDetailValues",
        "CustomDetails"
      ]
    },
    "BooleanCondition": {
      "type": "object",
      "required": [
        "innerConditions",
        "operator"
      ],
      "properties": {
        "innerConditions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Condition"
          }
        },
        "operator": {
          "$ref": "#/definitions/BooleanConditionSupportedOperator"
        }
      }
    },
    "BooleanConditionSupportedOperator": {
      "type": "string",
      "enum": [
        "And",
        "Or"
      ]
    },
    "CRDName": {
      "type": "string",
      "enum": [
        "MicrosoftSentinelAutomationRule"
      ]
    },
    "Condition": {
      "oneOf": [
        {
          "type": "object",
          "required": [
            "conditionProperties",
            "conditionType"
          ],
          "properties": {
            "conditionProperties": {
              "$ref": "#/definitions/BooleanCondition"
            },
            "conditionType": {
              "type": "string",
              "enum": [
                "Boolean"
              ]
            }
          }
        },
        {
          "type": "object",
          "required": [
            "conditionProperties",
            "conditionType"
          ],
          "properties": {
            "conditionProperties": {
              "$ref": "#/definitions/PropertyArrayChangedCondition"
            },
            "conditionType": {
              "type": "string",
              "enum": [
                "Property Array Changed"
              ]
            }
          }
        },
        {
          "type": "object",
          "required": [
            "conditionProperties",
            "conditionType"
          ],
          "properties": {
            "conditionProperties": {
              "$ref": "#/definitions/PropertyChangedCondition"
            },
            "conditionType": {
              "type": "string",
              "enum": [
                "Property Changed"
              ]
            }
          }
        },
        {
          "type": "object",
          "required": [
            "conditionProperties",
            "conditionType"
          ],
          "properties": {
            "conditionProperties": {
              "$ref": "#/definitions/PropertyArrayValuesCondition"
            },
            "conditionType": {
              "type": "string",
              "enum": [
                "PropertyArray"
              ]
            }
          }
        },
        {
          "type": "object",
          "required": [
            "conditionProperties",
            "conditionType"
          ],
          "properties": {
            "conditionProperties": {
              "$ref": "#/definitions/PropertyCondition"
            },
            "conditionType": {
              "type": "string",
              "enum": [
                "Property"
              ]
            }
          }
        }
      ]
    },
    "Metadata": {
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "namespace": {
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "MicrosoftSentinelAutomationRuleSpec": {
      "type": "object",
      "required": [
        "properties"
      ],
      "properties": {
        "properties": {
          "$ref": "#/definitions/Properties"
        }
      }
    },
    "PlaybookActionProperties": {
      "type": "object",
      "required": [
        "logicAppResourceId",
        "tenantId"
      ],
      "properties": {
        "logicAppResourceId": {
          "type": "string"
        },
        "tenantId": {
          "type": "string"
        }
      }
    },
    "Properties": {
      "type": "object",
      "required": [
        "actions",
        "displayName",
        "order",
        "triggeringLogic"
      ],
      "properties": {
        "actions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Action"
          }
        },
        "displayName": {
          "type": "string"
        },
        "order": {
          "type": "integer",
          "format": "int64"
        },
        "triggeringLogic": {
          "$ref": "#/definitions/TriggeringLogic"
        }
      }
    },
    "PropertyArrayChangedCondition": {
      "type": "object",
      "required": [
        "arrayType",
        "changeType"
      ],
      "properties": {
        "arrayType": {
          "$ref": "#/definitions/PropertyArrayChangedConditionSupportedArrayType"
        },
        "changeType": {
          "$ref": "#/definitions/PropertyArrayChangedConditionSupportedChangeType"
        }
      }
    },
    "PropertyArrayChangedConditionSupportedArrayType": {
      "type": "string",
      "enum": [
        "Alerts",
        "Comments",
        "Labels",
        "Tactics"
      ]
    },
    "PropertyArrayChangedConditionSupportedChangeType": {
      "type": "string",
      "enum": [
        "Added"
      ]
    },
    "PropertyArrayConditionSupportedArrayConditionType": {
      "type": "string",
      "enum": [
        "AnyItem"
      ]
    },
    "PropertyArrayValuesCondition": {
      "type": "object",
      "required": [
        "arrayConditionType",
        "arrayType",
        "itemConditions"
      ],
      "properties": {
        "arrayConditionType": {
          "$ref": "#/definitions/PropertyArrayConditionSupportedArrayConditionType"
        },
        "arrayType": {
          "$ref": "#/definitions/ArrayConditionSupportedArrayType"
        },
        "itemConditions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Condition"
          }
        }
      }
    },
    "PropertyChangedCondition": {
      "type": "object",
      "required": [
        "changeType",
        "operator",
        "propertyValues",
        "properyName"
      ],
      "properties": {
        "changeType": {
          "$ref": "#/definitions/PropertyChangedConditionSupportedChangedType"
        },
        "operator": {
          "$ref": "#/definitions/PropertyConditionSupportedOperator"
        },
        "propertyValues": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "properyName": {
          "$ref": "#/definitions/PropertyChangedConditionSupportedPropertyType"
        }
      }
    },
    "PropertyChangedConditionSupportedChangedType": {
      "type": "string",
      "enum": [
        "ChangedFrom",
        "ChangedTo"
      ]
    },
    "PropertyChangedConditionSupportedPropertyType": {
      "type": "string",
      "enum": [
        "IncidentOwner",
        "IncidentSeverity",
        "IncidentStatus"
      ]
    },
    "PropertyCondition": {
      "type": "object",
      "required": [
        "operator",
        "propertyName",
        "propertyValues"
      ],
      "properties": {
        "operator": {
          "$ref": "#/definitions/PropertyConditionSupportedOperator"
        },
        "propertyName": {
          "$ref": "#/definitions/PropertyConditionSupportedProperty"
        },
        "propertyValues": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "PropertyConditionSupportedOperator": {
      "type": "string",
      "enum": [
        "Contains",
        "EndsWith",
        "Equals",
        "NotContains",
        "NotEndsWith",
        "NotEquals",
        "NotStartsWith",
        "StartsWith"
      ]
    },
    "PropertyConditionSupportedProperty": {
      "type": "string",
      "enum": [
        "AccountAadTenantId",
        "AccountAadUserId",
        "AccountNTDomain",
        "AccountName",
        "AccountObjectGuid",
        "AccountPUID",
        "AccountSid",
        "AccountUPNSuffix",
        "AlertAnalyticRuleIds",
        "AlertProductNames",
        "AzureResourceResourceId",
        "AzureResourceSubscriptionId",
        "CloudApplicationAppId",
        "CloudApplicationAppName",
        "DNSDomainName",
        "FileDirectory",
        "FileHashValue",
        "FileName",
        "HostAzureID",
        "HostNTDomain",
        "HostName",
        "HostNetBiosName",
        "HostOSVersion",
        "IPAddress",
        "IncidentCustomDetailsKey",
        "IncidentCustomDetailsValue",
        "IncidentDescription",
        "IncidentLabel",
        "IncidentProviderName",
        "IncidentRelatedAnalyticRuleIds",
        "IncidentSeverity",
        "IncidentStatus",
        "IncidentTactics",
        "IncidentTitle",
        "IncidentUpdatedBySource",
        "IoTDeviceId",
        "IoTDeviceModel",
        "IoTDeviceName",
        "IoTDeviceOperatingSystem",
        "IoTDeviceType",
        "IoTDeviceVendor",
        "MailMessageDeliveryAction",
        "MailMessageDeliveryLocation",
        "MailMessageP1Sender",
        "MailMessageP2Sender",
        "MailMessageRecipient",
        "MailMessageSenderIP",
        "MailMessageSubject",
        "MailboxDisplayName",
        "MailboxPrimaryAddress",
        "MailboxUPN",
        "MalwareCategory",
        "MalwareName",
        "ProcessCommandLine",
        "ProcessId",
        "RegistryKey",
        "RegistryValueData",
        "Url"
      ]
    },
    "RunPlaybookAction": {
      "type": "object",
      "required": [
        "actionConfiguration",
        "actionType",
        "order"
      ],
      "properties": {
        "actionConfiguration": {
          "$ref": "#/definitions/PlaybookActionProperties"
        },
        "actionType": {
          "$ref": "#/definitions/RunPlaybookActionType"
        },
        "order": {
          "type": "integer",
          "format": "int64"
        }
      }
    },
    "RunPlaybookActionType": {
      "type": "string",
      "enum": [
        "Run Playbook"
      ]
    },
    "TriggeringLogic": {
      "type": "object",
      "required": [
        "conditions",
        "expirationTimeUtc",
        "isEnabled",
        "triggersOn",
        "triggersWhen"
      ],
      "properties": {
        "conditions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Condition"
          }
        },
        "expirationTimeUtc": {
          "type": "string"
        },
        "isEnabled": {
          "type": "boolean"
        },
        "triggersOn": {
          "$ref": "#/definitions/TriggersOn"
        },
        "triggersWhen": {
          "$ref": "#/definitions/TriggersWhen"
        }
      }
    },
    "TriggersOn": {
      "type": "string",
      "enum": [
        "Incident",
        "Alerts"
      ]
    },
    "TriggersWhen": {
      "type": "string",
      "enum": [
        "Created",
        "Updated"
      ]
    }
  }
}